@font-face {
  font-family: 'Intel One Mono';
  src: url('/fonts/intel-one-mono-vf.woff2') format('woff2-variations'),
       url('/fonts/intel-one-mono-vf.woff2') format('woff2');
  font-weight: 300 700;
  font-display: swap;
}

@tailwind base;
@tailwind components;
@tailwind utilities;

/* 
   THE MASTER DIALS: "Earth & Ochre" Palette
   The application now ignores system/browser preferences and relies 
   entirely on internal state toggling.
*/

:root {
  /* UI LOCKDOWN: Tells the browser we handle our own color schemes entirely */
  forced-color-adjust: none !important;
  color-scheme: light dark; /* Support both, but we control the toggle */
}

/* Explicitly bind Tailwind's Prose (Typography) to our variables 
   to prevent browser "auto-dark" from guessing colors. */
.prose {
  --tw-prose-body: var(--text-main);
  --tw-prose-headings: var(--text-main);
  --tw-prose-lead: var(--text-muted);
  --tw-prose-links: var(--text-accent);
  --tw-prose-bold: var(--text-main);
  --tw-prose-counters: var(--text-muted);
  --tw-prose-bullets: var(--border-strong);
  --tw-prose-hr: var(--border-subtle);
  --tw-prose-quotes: var(--text-main);
  --tw-prose-quote-borders: var(--border-strong);
  --tw-prose-captions: var(--text-muted);
  --tw-prose-code: var(--text-main);
  --tw-prose-pre-code: var(--text-main);
  --tw-prose-pre-bg: var(--bg-subject);
  --tw-prose-th-borders: var(--border-strong);
  --tw-prose-td-borders: var(--border-subtle);
}

:root:not(.dark) {
  /* --- LIGHT THEME: "Unified Frost Atmosphere" --- */
  --foundation: #ffffff80;     /* The core transparency layer */
  --bg-app: #ffffff80;         
  --bg-class: #ffffff80;       
  --bg-subject: #ffffff80;     
  --bg-topic: #ffffff80;       
  --bg-topic-hover: #ffffffb0; 
  
  --text-main: #2C2724;
  --text-muted: #44403C;
  --text-accent: #92400E;
  --text-danger: #991B1B;

  /* SOFT CATEGORICAL PALETTE - Global Restore */
  --cat-nav: #4F6F52;      /* Deep Sage */
  --cat-create: #86A789;   /* Soft Sage - Base Creation */
  --cat-subject: #86A789;  /* Soft Sage - Subjects */
  --cat-topic: #7D9D9C;    /* Muted Teal - Topics */
  --cat-item: #A8B689;     /* Soft Olive - Items */
  --cat-manage: #607274;   /* Steel Teal */
  --cat-data: #A27B5C;     /* Muted Earth */
  --cat-help: #739072;     /* Muted Green */
  --cat-filter: #665A48;   /* Dusty Umber */
  --cat-danger: #991B1B;   /* Terracotta */
  --btn-fg: #F0EEE6;       

  /* ANALYTICS SPECIFIC - Scoped variables */
  --an-class: #435B66;     
  --an-subject: #A27B5C;   
  --an-topic: #665A48;     
  --an-danger: #A05344;    

  --border-subtle: #DCD9D0;
  --border-strong: #C9C6BC;
  --border-focus: #B45309;

  --status-done-bg: #D1FAE5;   
  --status-done-text: #065F46; 
  --status-mid-bg: #FEF3C7;    
  --status-mid-text: #92400E;  
  --status-low-bg: #FFEDD5;    
  --status-low-text: #9A3412;  
  --status-zero-bg: #E5E7EB;   
  --status-zero-text: #374151;
  --selection-bg: #ffffff99;     
  --shadow-card: 0 8px 32px 0 rgba(44, 39, 36, 0.08);

  scrollbar-color: var(--text-muted) var(--foundation);
}

/* GLOBAL BUTTON ENGINE: Standardizes foreground and hover reversal */
.btn-high-speed {
    color: var(--btn-fg) !important;
    font-weight: 500 !important; /* Intel One Mono Medium - Not Bold */
    transition-property: background-color, color, border-color, box-shadow, opacity, transform;
    transition-duration: 0.2s;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid transparent;
}

/* CRISPY UTILITY: Applied only to Analytics */
.btn-crispy {
    border: 1px solid #262624 !important;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

/* HARMONIC ANALYTICS SPECTRUM */
.tab-overview { --tab-bg: #4F6F52; } /* Deep Sage */
.tab-quickwins { --tab-bg: #86A789; } /* Soft Sage */
.tab-insights { --tab-bg: #739072; } /* Muted Green */
.tab-hierarchy { --tab-bg: #607274; } /* Steel Teal - Unified for Class/Subj/Topic */
.tab-zombies { --tab-bg: #A27B5C; } /* Muted Earth */
.tab-overdue { --tab-bg: #A05344; } /* Burnt Terracotta */
.tab-health { --tab-bg: #665A48; } /* Soil Umber */

.btn-harmonic {
    background-color: var(--tab-bg);
    border-color: var(--tab-bg);
    color: var(--btn-fg) !important;
    font-size: 0.75rem !important; /* text-xs */
    font-weight: 500 !important;    /* Intel One Mono Medium - Not Bold */
    letter-spacing: 0.025em !important; /* tracking-wide */
}

.btn-harmonic:hover, .btn-harmonic.active {
    background-color: var(--btn-fg);
    color: var(--tab-bg) !important;
    border-color: var(--tab-bg);
}

/* ... Rest of existing styles ... */

/* Category Application & Hover Inversion */
.btn-nav { background-color: var(--cat-nav); border-color: var(--cat-nav); }
.btn-nav:hover, .btn-nav.active { background-color: var(--btn-fg); color: var(--cat-nav) !important; }

.btn-create { background-color: var(--cat-create); border-color: var(--cat-create); }
.btn-create:hover { background-color: var(--btn-fg); color: var(--cat-create) !important; }

.btn-subject { background-color: var(--cat-subject); border-color: var(--cat-subject); }
.btn-subject:hover { background-color: var(--btn-fg); color: var(--cat-subject) !important; }

.btn-topic { background-color: var(--cat-topic); border-color: var(--cat-topic); }
.btn-topic:hover { background-color: var(--btn-fg); color: var(--cat-topic) !important; }

.btn-item { background-color: var(--cat-item); border-color: var(--cat-item); }
.btn-item:hover { background-color: var(--btn-fg); color: var(--cat-item) !important; }

.btn-manage { background-color: var(--cat-manage); border-color: var(--cat-manage); }
.btn-manage:hover { background-color: var(--btn-fg); color: var(--cat-manage) !important; }

.btn-data { background-color: var(--cat-data); border-color: var(--cat-data); }
.btn-data:hover { background-color: var(--btn-fg); color: var(--cat-data) !important; }

.btn-help { background-color: var(--cat-help); border-color: var(--cat-help); }
.btn-help:hover { background-color: var(--btn-fg); color: var(--cat-help) !important; }

.btn-filter { background-color: var(--cat-filter); border-color: var(--cat-filter); }
.btn-filter:hover, .btn-filter.active { background-color: var(--btn-fg); color: var(--cat-filter) !important; }

.btn-danger { background-color: var(--cat-danger); border-color: var(--cat-danger); }
.btn-danger:hover { background-color: var(--btn-fg); color: var(--cat-danger) !important; }

/* ... Rest of existing styles (checkboxes, modal, etc.) ... */

/* Checkbox & Control Lockdown */
input[type="checkbox"] {
    appearance: none;
    width: 1.2rem;
    height: 1.2rem;
    border: 2px solid #262624;
    background-color: #C2C0B6;
    border-radius: 4px;
    cursor: pointer;
    position: relative;
    transition: background-color 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
}

input[type="checkbox"]:checked {
    background-color: #262624;
}

input[type="checkbox"]:checked::after {
    content: 'âœ“';
    position: absolute;
    color: #C2C0B6;
    font-size: 0.9rem;
    font-weight: bold;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
}

.close-button-base {
    background-color: #C2C0B6;
    color: #262624;
    transition: background-color 0.2s ease, color 0.2s ease, opacity 0.2s ease;
}

.close-button-base:hover {
    background-color: #991B1B; /* Terracotta */
    color: white;
}

.control-button-base {
    background-color: #C2C0B6;
    color: #262624;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
    font-weight: bold;
    transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}

.control-button-base:hover, .control-button-base.active {
    background-color: #262624;
    color: #C2C0B6;
}

/* Explicit class-based dark mode override */
.dark {
    --bg-app: #1C1917;
    --bg-class: #292524;
    --bg-subject: #1C1917;
    --bg-topic: #44403C;
    --bg-topic-hover: #57534E;

    --text-main: #F5F5F4;
    --text-muted: #D6D3D1;
    --text-accent: #F59E0B;
    --text-danger: #EF4444;

    --border-subtle: #44403C;
    --border-strong: #57534E;
    --border-focus: #F59E0B;

    --status-done-bg: #064E3B;   
    --status-done-text: #6EE7B7; 
    --status-mid-bg: #78350F;    
    --status-mid-text: #FDE68A;  
    --status-low-bg: #7C2D12;    
    --status-low-text: #FFEDD5;  
    --status-zero-bg: #44403C;   
    --status-zero-text: #A8A29E; 

    --selection-bg: #451A03;     
    --shadow-card: 0 4px 6px -1px rgba(38, 38, 36, 0.4);

    scrollbar-color: var(--text-muted) var(--bg-subject);
}

/* --- Foundation --- */
html, body {
    /* Hard block on OS color overrides at root level */
    forced-color-adjust: none !important;
    -webkit-print-color-adjust: exact;
}

html {
    /* Lock the transparent atmosphere foundation */
    background-color: #ffffff80 !important;
}

body { 
    font-family: 'Intel One Mono', sans-serif; 
    background-color: #ffffff80 !important; /* The core atmosphere layer */
    color: var(--text-main);
    backdrop-filter: blur(12px); /* High-end Crispy Frost */
    -webkit-backdrop-filter: blur(12px);
    transition: background-color 0.8s cubic-bezier(0.4, 0, 0.2, 1), color 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    min-height: 100vh;
    
    /* UI STABILIZATION: Force consistent text rendering across engines */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
}

/* =============================================================================
   ACCESSIBILITY & FOCUS
   ============================================================================= */
:focus-visible {
    outline: 2px solid var(--text-accent) !important;
    outline-offset: 2px !important;
    box-shadow: 0 0 0 4px var(--selection-bg) !important;
}

[data-class-id]:focus-visible,
[data-subject-id]:focus-visible,
[data-topic-id]:focus-visible {
    border-color: var(--text-accent) !important;
}

/* =============================================================================
   PROGRESS PILLS & UI
   ============================================================================= */
.progress-pill {
    display: inline-flex;
    align-items: center;
    font-size: 0.7rem;
    font-weight: 800;
    padding: 2px 8px;
    border-radius: 4px;
    min-width: 40px;
    justify-content: center;
}

.pill-done { background: var(--status-done-bg); color: var(--status-done-text); }
.pill-mid  { background: var(--status-mid-bg);  color: var(--status-mid-text);  }
.pill-low  { background: var(--status-low-bg);  color: var(--status-low-text);  }
.pill-zero { background: var(--status-zero-bg); color: var(--status-zero-text); }

.topic-selected {
    background-color: var(--selection-bg) !important;
    border-color: var(--text-accent) !important;
}

/* Scrollbars */
.cp-scroll::-webkit-scrollbar { width: 10px; height: 10px; }
.cp-scroll::-webkit-scrollbar-thumb { background: var(--text-muted); border: 2px solid var(--bg-app); border-radius: 10px; }
.cp-scroll::-webkit-scrollbar-thumb:hover { background: var(--text-accent); }
.cp-scroll::-webkit-scrollbar-track { background: var(--bg-subject); border-radius: 10px; }

/* Global scroll behavior */
html { scroll-behavior: smooth; }
body { overflow-y: scroll; } /* Keep scrollbar gutter even if content is short */

/* Inputs */
input:not([type="checkbox"]), textarea, select {
    background-color: var(--bg-topic);
    border: 1px solid var(--border-strong);
    color: var(--text-main);
    border-radius: 6px;
    padding: 4px 8px;
}
input:focus, textarea:focus, select:focus {
    border-color: var(--text-accent);
    outline: none;
    box-shadow: 0 0 0 2px var(--selection-bg);
}

/* Drag Handles */
.drag-handle { opacity: 0.4; cursor: move; padding: 0.5rem; color: var(--text-muted); }
.drag-handle:hover { opacity: 1; background-color: var(--border-subtle); border-radius: 4px; }

/* Animations */
.highlight { animation: highlightFade 1.5s ease-out; }
@keyframes highlightFade {
    0% { background-color: var(--status-mid-bg); } 
    100% { background-color: transparent; }
}

@media print {
    .no-print { display: none !important; }
    body { background: #FBF9F4; color: #262624; }
}
